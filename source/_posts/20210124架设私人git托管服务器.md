---
layout: post
title: 架设私人git托管服务器
date: 2021-01-24 01:24:29
updated:
categories: [git]
tags:
  - git
permalink:
excerpt: 记录配置过程
---

### 一、服务器端配置
#### 1. 安装git
* 1.1 下载安装
{% codeblock lang:bash line_number:true %}
  # 下载git源码({% link git不同版本 https://mirrors.edge.kernel.org/pub/software/scm/git/ %})
  wget -O /tmp/git-2.9.5.tar.gz https://mirrors.edge.kernel.org/pub/software/scm/git/git-2.9.5.tar.gz
  # 解压 -z:有zip属性的 -x:解压 -v:显示所有过程 -f:必须参数，后面接文件名
  tar -zxvf /tmp/git-2.9.5.tar.gz -C /tmp/
  # 安装依赖
  yum install -y zlib-devel perl-ExtUtils-MakeMaker
  # 进入解压后目录，检验相关依赖，设置安装路径
  cd /tmp/git-2.9.5
  ./configure --prefix=/usr/local/git
  # 编译安装
  make && make install
  # 配置全局路径
  # echo "export PATH=$PATH:/usr/local/git/bin" >> /etc/profile
  # source /etc/profile
  # 测试是否安装成功
  git --version
{% endcodeblock %}
<span class="color-red" id="note-git-config">
  注：上面<b class="color-black-1"># 配置全局路径</b>这一步，在后续通过nvm安装nodejs出现冲突，会覆盖/etc/profile.d/*.sh导出的PATH,导致nvm下node路径无效。
</span><br/>
<span class="color-green">建议改为新建<code>/etc/profile.d/git.sh</code>文件，内容为<code>export PATH=$PATH:/usr/local/git/bin</code></span>

* 1.2 git基础配置
``` bash
git config --global user.name test
git config --global user.email test@163.com
```

#### 2. 安装nvm
* 2.1 下载（$HOME改为目标目录，如/usr/local/nvm），参考[官方教程-github](https://github.com/nvm-sh/nvm#git-install)
``` bash
export NVM_DIR="$HOME/.nvm" && (
  git clone https://github.com/nvm-sh/nvm.git "$NVM_DIR"
  cd "$NVM_DIR"
  git checkout `git describe --abbrev=0 --tags --match "v[0-9]*" $(git rev-list --tags --max-count=1)`
) && \. "$NVM_DIR/nvm.sh"
```
* 2.2 配置环境变量
``` bash
touch /etc/profile.d/nvm.sh
// 里面输入以下内容，保存
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh" # This loads nvm
```
* 2.3 测试
``` bash
nvm -v
```

#### 3. nvm安装nodejs
* 3.1 如果当前用户没有权限，优先授权（`sudo chown -R currentUser /usr/local/nvm`）
``` bash
nvm install node
# 查看node版本
node -v
# use the installed version
# nvm use node
```
* 3.2 <span class="line-through">配置shell使用node（不进行这一步下次进入就无法执行node命令，应该是PATH没配置）</span><span class="color-red">（这一步骤不再需要执行，出现问题是由于[上面一步](#note-git-config)设置错误导致）</span>
``` bash
vim /etc/profile.d/nvm.sh
```
在后面加入以下命令，保存
``` bash
# 用户进来使用的node版本,这里node可换为任意已安装版本，如15.7.0
nvm use node
```
* 3.3 npm配置以及安装一些全局工具
``` bash
npm install pm2 webpack -g
```
这里全局默认安装位置为`/usr/local/nvm/versions/node/v15.7.0/lib`，也可以修改默认配置
``` bash
# default
npm config get prefix # /usr/local/nvm/versions/node/v15.7.0
npm config get cache  # /root/.npm
npm config get registry # https://registry.npmjs.org/
npm config set prefix otherPath/node_global
npm config set cache otherPath/node_cache
npm config set registry https://registry.npm.taobao.org
```
