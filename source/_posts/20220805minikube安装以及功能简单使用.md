---
layout: post
title: minikube安装以及功能简单使用
date: 2022-08-05 23:30:07
updated: 2022-08-22 09:22
categories: [docker]
tags:
  - docker
  - minikube
  - kubectl
  - kubernetes
permalink:
excerpt: minikebu简单使用
---

> 参考官方安装教程(https://minikube.sigs.k8s.io/docs/start/)  
> 参考视频  
> <span class="color-red">操作环境: `Linux ubuntu-server-22.04 5.15.0-43-generic #46-Ubuntu SMP x86_64 x86_64 x86_64 GNU/Linux`</span>
> <span class="color-red">前提条件: 已经安装了`docker`</span>

### 一、安装kubectl
> https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/
* 使用snap安装
  ```bash
  sudo snap install kubectl --classic
  kubectl version --client
  ```
* 效果

  {% asset_img kubectl_install_ok_2022-08-06_00-20-42.png %}

### 二、安装minikube
1.1 安装最新稳定版版minikube
* 下载deb文件
  ```bash
  curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube_latest_amd64.deb
  ```
* 使用dpkg安装
  ```bash
  sudo dpkg -i minikube_latest_amd64.deb
  ```

1.2 启动集群
> 如果不用`--kubernetes-version=v1.23.8`会报错=>https://github.com/kubernetes/minikube/issues/14477  
* 后面的参数同样重要
  ```bash
  minikube start --kubernetes-version=v1.23.8 --image-mirror-country='cn' --image-repository='registry.cn-hangzhou.aliyuncs.com/google_containers'
  ```

  {% asset_img minikube_start_ok_2022-08-06_00-13-18.png %}

### 三、minikube功能
> <span class="color-red">注意:</span> 
> 1\. 以下IP`192.168.78.134`为实验用的虚拟机ip地址，与外部主机网络连接为NAT模式; 另一IP为`192.168.49.1`是与minikube通信用;
> 2\. 使用`minikube ip`后获得的IP为`192.168.49.2`;

#### 3.1 访问dashboard
* 开启dashboard
  ```bash
  # --port指定暴露端口 --url打印访问url
  minikube dashboard  --port=8001 --url
  ```
* 从外部访问Dashboard,使用kubectl设置代理
  ```bash
  # --address开启服务的ip  --port需要暴露的端口
  kubectl proxy --port=8001 --address='192.168.78.134' --accept-hosts='^.*'
  ```
* 效果如下

  {% asset_img bashboard_start_ok_2022-08-06_01-57-48.png %}

#### 3.2 外部访问服务Service
* 查看服务访问地址以及端口
  ```bash
  dzdhello@ubuntu-server-22:~$ minikube service webapp-service
  |-----------|----------------|-------------|---------------------------|
  | NAMESPACE |      NAME      | TARGET PORT |            URL            |
  |-----------|----------------|-------------|---------------------------|
  | default   | webapp-service |        3000 | http://192.168.49.2:30100 |
  |-----------|----------------|-------------|---------------------------|
  🎉  Opening service default/webapp-service in default browser...
  👉  http://192.168.49.2:30100
  ```
* 设置代理
  ```bash
  dzdhello@ubuntu-server-22:~$ kubectl port-forward --address 192.168.78.134 service/webapp-service 3000:3000
  Forwarding from 192.168.78.134:3000 -> 3000
  ```
  然后在外部主机可以通过`192.168.78.134:3000`访问了:

  {% asset_img Snipaste_2022-08-22_08-52-06.png %}
