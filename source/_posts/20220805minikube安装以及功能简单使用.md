---
layout: post
title: minikubeå®‰è£…ä»¥åŠåŠŸèƒ½ç®€å•ä½¿ç”¨
date: 2022-08-05 23:30:07
updated: 2022-08-22 09:22
categories: [docker]
tags:
  - docker
  - minikube
  - kubectl
  - kubernetes
permalink:
excerpt: minikebuç®€å•ä½¿ç”¨
---

> å‚è€ƒå®˜æ–¹å®‰è£…æ•™ç¨‹(https://minikube.sigs.k8s.io/docs/start/)  
> å‚è€ƒè§†é¢‘  
> <span class="color-red">æ“ä½œç¯å¢ƒ: `Linux ubuntu-server-22.04 5.15.0-43-generic #46-Ubuntu SMP x86_64 x86_64 x86_64 GNU/Linux`</span>
> <span class="color-red">å‰ææ¡ä»¶: å·²ç»å®‰è£…äº†`docker`</span>

### ä¸€ã€å®‰è£…kubectl
> https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/
* ä½¿ç”¨snapå®‰è£…
  ```bash
  sudo snap install kubectl --classic
  kubectl version --client
  ```
* æ•ˆæœ

  {% asset_img kubectl_install_ok_2022-08-06_00-20-42.png %}

### äºŒã€å®‰è£…minikube
1.1 å®‰è£…æœ€æ–°ç¨³å®šç‰ˆç‰ˆminikube
* ä¸‹è½½debæ–‡ä»¶
  ```bash
  curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube_latest_amd64.deb
  ```
* ä½¿ç”¨dpkgå®‰è£…
  ```bash
  sudo dpkg -i minikube_latest_amd64.deb
  ```

1.2 å¯åŠ¨é›†ç¾¤
> å¦‚æœä¸ç”¨`--kubernetes-version=v1.23.8`ä¼šæŠ¥é”™=>https://github.com/kubernetes/minikube/issues/14477  
* åé¢çš„å‚æ•°åŒæ ·é‡è¦
  ```bash
  minikube start --kubernetes-version=v1.23.8 --image-mirror-country='cn' --image-repository='registry.cn-hangzhou.aliyuncs.com/google_containers'
  ```

  {% asset_img minikube_start_ok_2022-08-06_00-13-18.png %}

### ä¸‰ã€minikubeåŠŸèƒ½
> <span class="color-red">æ³¨æ„:</span> 
> 1\. ä»¥ä¸‹IP`192.168.78.134`ä¸ºå®éªŒç”¨çš„è™šæ‹Ÿæœºipåœ°å€ï¼Œä¸å¤–éƒ¨ä¸»æœºç½‘ç»œè¿æ¥ä¸ºNATæ¨¡å¼; å¦ä¸€IPä¸º`192.168.49.1`æ˜¯ä¸minikubeé€šä¿¡ç”¨;
> 2\. ä½¿ç”¨`minikube ip`åè·å¾—çš„IPä¸º`192.168.49.2`;

#### 3.1 è®¿é—®dashboard
* å¼€å¯dashboard
  ```bash
  # --portæŒ‡å®šæš´éœ²ç«¯å£ --urlæ‰“å°è®¿é—®url
  minikube dashboard  --port=8001 --url
  ```
* ä»å¤–éƒ¨è®¿é—®Dashboard,ä½¿ç”¨kubectlè®¾ç½®ä»£ç†
  ```bash
  # --addresså¼€å¯æœåŠ¡çš„ip  --portéœ€è¦æš´éœ²çš„ç«¯å£
  kubectl proxy --port=8001 --address='192.168.78.134' --accept-hosts='^.*'
  ```
* æ•ˆæœå¦‚ä¸‹

  {% asset_img bashboard_start_ok_2022-08-06_01-57-48.png %}

#### 3.2 å¤–éƒ¨è®¿é—®æœåŠ¡Service
* æŸ¥çœ‹æœåŠ¡è®¿é—®åœ°å€ä»¥åŠç«¯å£
  ```bash
  dzdhello@ubuntu-server-22:~$ minikube service webapp-service
  |-----------|----------------|-------------|---------------------------|
  | NAMESPACE |      NAME      | TARGET PORT |            URL            |
  |-----------|----------------|-------------|---------------------------|
  | default   | webapp-service |        3000 | http://192.168.49.2:30100 |
  |-----------|----------------|-------------|---------------------------|
  ğŸ‰  Opening service default/webapp-service in default browser...
  ğŸ‘‰  http://192.168.49.2:30100
  ```
* è®¾ç½®ä»£ç†
  ```bash
  dzdhello@ubuntu-server-22:~$ kubectl port-forward --address 192.168.78.134 service/webapp-service 3000:3000
  Forwarding from 192.168.78.134:3000 -> 3000
  ```
  ç„¶ååœ¨å¤–éƒ¨ä¸»æœºå¯ä»¥é€šè¿‡`192.168.78.134:3000`è®¿é—®äº†:

  {% asset_img Snipaste_2022-08-22_08-52-06.png %}
